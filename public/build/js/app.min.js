window.addEventListener("DOMContentLoaded",function(e){"use strict";var n,t=document.getElementById("closeUpload"),o=document.getElementById("uploadImageInput"),a=document.getElementById("uploadBox"),d=document.getElementById("imageComments"),i=(document.getElementById("imageBig"),document.getElementById("closeComments")),l=(document.getElementById("imageBig"),document.getElementById("imageName")),c=document.getElementById("gallery"),s="",m=document.getElementById("btnLogin"),r=document.getElementById("btnLogout"),u=document.getElementById("btnUploadImage"),g=document.getElementById("send"),y=document.getElementById("message"),v=document.getElementById("comment"),p=document.getElementById("username"),f=document.getElementsByName("author")[0];r.disabled=!0,g.disabled=!0,m.addEventListener("click",function(e){m.disabled=!0,n&&n.connected||(n=io({forceNew:!0})),n.on("connect",function(){r.disabled=!1,g.disabled=!1,p.disabled=!0,console.log("Socket.io: Connection open"),u.classList.remove("hidden"),f.value=p.value,n.emit("login",p.value),n.emit("gallery")}),n.on("disconnect",function(){m.disabled=!1,p.disabled=!1,p.value="",console.log("Socket.io: Connection closed")}),n.on("error",function(e){y.textContent="Błąd połączenia z serwerem: "+JSON.stringify(e)}),n.on("comment",function(e){y.innerHTML="";for(var n=0;n<e.length;n++){var t=document.createElement("p");e[n].nazwa==s&&(t.innerHTML="<strong>"+e[n].autor+"</strong>: "+e[n].tekst,y.appendChild(t))}}),n.on("newComment",function(e){var n=document.getElementById(e),t=document.getElementById(e+"+kom");t.textContent="New comment",n.addEventListener("click",function(e){t.textContent=""})}),n.on("showImages",function(e){for(var n="",t=0;t<e.length;t++)n+='<div class="col-sm-4 col-md-3 gallery-img">',n+='<div class="embed-responsive embed-responsive-16by9 gallery-image-wrapper">',n+='<img class="newComment" id="'+e[t].nazwa+'" src="upload/'+e[t].nazwa+'">',n+="</div>",n+='<span class="newComment" id="'+e[t].nazwa+'+kom"></span>',n+='<p class="imageAuthor">Author: '+e[t].autor+"</p>",n+='<p class="imageUploadDate">Upload date: '+e[t].data_dodania+"</p>",n+="</div>";c.innerHTML=n,n=""}),$("#uploadForm").submit(function(e){e.preventDefault();var t=new FormData($(this)[0]);$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:t,async:!1,contentType:!1,processData:!1,success:function(e){console.log(e),n.emit("gallery")},error:function(e){console.log("Upload error!"),console.log(e)}})})}),r.addEventListener("click",function(e){r.disabled=!0,g.disabled=!0,m.disabled=!1,y.textContent="",u.classList.add("hidden"),n.io.disconnect(),console.dir(n),c.innerHTML='<h1 class="gallery-info">Please login if you want to see gallery.</h1>'}),g.addEventListener("click",function(e){n.emit("message",{text:v.value,username:p.value,imgName:l.value}),v.value=""}),u.addEventListener("click",function(){a.style.display="block"}),t.addEventListener("click",function(){a.style.display="none"}),o.addEventListener("click",function(){a.style.display="none"}),i.addEventListener("click",function(){$(d).fadeOut(200),s=""}),m.addEventListener("click",function(){r.classList.remove("hidden"),m.classList.add("hidden")}),r.addEventListener("click",function(){r.classList.add("hidden"),m.classList.remove("hidden")}),$("#gallery").on("click",".gallery-image-wrapper",function(e){if(console.log(e.target),n&&n.connected){var t=e.target.src,o=e.target.id;$(d).fadeIn(200),$("#imageBig").attr("src",t),setInterval(function(){var e=document.getElementById("allComments");e.scrollTop=e.scrollHeight},100),$("#imageName").val(o),s=o,y.innerHTML="",n.emit("comm")}})});